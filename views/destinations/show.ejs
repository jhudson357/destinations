<%- include('../partials/html-head') %>
<%- include('../partials/nav') %>

<section>
  <h1><%= title %> </h1>
  <% if (user) { %>
    <h2>Write a Review</h2>
    <form action="/destinations/<%= destination._id %>/reviews " method="POST">
      <label>
        Title:
        <input type="text" name="title">
      </label>
      <label>
        Date Visited:
        <input type="text" name="dateVisited" placeholder="Month Year">
      </label>
      <label>
        Recommend:
        <input type="checkbox" name="recommend">
      </label>
      <label>
        Review:
        <textarea name="review"></textarea>
      </label>
      <label>
        Rating:
        <select name="rating">
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5" selected>5</option>
        </select>
      </label>
      <button type="submit">Save Review</button>
    </form>
  <% } %>
  <h2>Reviews</h2>
  <% if (destination.reviews.length) { %>
    <% destination.reviews.forEach(review => { %>
      <a href="/destinations/<%= destination._id %>/reviews/<%= review._id %>">
        <h2><%= review.title %> </h2>
      </a>
      <p>Rating: <%= review.rating %> </p>
      <p>Recommend: <%= review.recommend ? 'Yes' : 'No' %> </p>
      <% if (review.author._id.equals(user?.profile._id)) { %>
        <form action="/destinations/<%= destination._id %>/reviews/<%= review._id %>?_method=DELETE" method="POST">
          <button type="submit">DELETE</button>
        </form>
      <% } %>
    <% }) %>
  <% } else { %>
    <h2>No Reviews Yet</h2>
  <% } %>
  <div>
    <a href="/destinations">
      <button>All Destinations</button>
    </a>
  </div>
</section>

<%- include('../partials/footer') %>
